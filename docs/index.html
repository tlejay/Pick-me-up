<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposal Viewer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Google Fonts: Inter & Sarabun (for Thai support) -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Sarabun', 'sans-serif'],
                    },
                    colors: {
                        primary: '#2563eb',
                        secondary: '#475569',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Typography for Markdown Content */
        .prose h1 {
            @apply text-4xl font-bold text-slate-900 mb-6 border-b pb-4 mt-10;
        }

        .prose h1:first-child {
            @apply mt-0;
        }

        .prose h2 {
            @apply text-2xl font-semibold text-slate-800 mb-4 mt-8 pb-2 border-b border-slate-200;
        }

        .prose h3 {
            @apply text-xl font-semibold text-slate-800 mb-3 mt-6;
        }

        .prose h4 {
            @apply text-lg font-medium text-slate-700 mb-2 mt-4;
        }

        .prose p {
            @apply text-slate-600 leading-relaxed mb-4 text-base;
        }

        .prose ul {
            @apply list-disc list-outside ml-6 mb-4 text-slate-600;
        }

        .prose ol {
            @apply list-decimal list-outside ml-6 mb-4 text-slate-600;
        }

        .prose li {
            @apply mb-1 pl-1;
        }

        .prose strong {
            @apply font-semibold text-slate-900;
        }

        .prose a {
            @apply text-blue-600 hover:text-blue-800 underline transition-colors;
        }

        .prose blockquote {
            @apply border-l-4 border-blue-500 pl-4 py-1 italic bg-slate-50 text-slate-700 my-4 rounded-r;
        }

        .prose code {
            @apply bg-slate-100 text-pink-600 px-1.5 py-0.5 rounded text-sm font-mono border border-slate-200;
        }

        .prose pre {
            @apply bg-slate-800 text-slate-100 p-4 rounded-lg overflow-x-auto mb-6 shadow-md;
        }

        .prose pre code {
            @apply bg-transparent text-inherit border-none p-0;
        }

        .prose table {
            @apply w-full text-left border-collapse my-6 shadow-sm rounded-lg overflow-hidden;
        }

        .prose th {
            @apply bg-slate-100 text-slate-700 font-semibold p-3 border-b border-slate-200;
        }

        .prose td {
            @apply p-3 border-b border-slate-100 text-slate-600;
        }

        .prose tr:last-child td {
            @apply border-b-0;
        }

        .prose hr {
            @apply border-slate-200 my-8;
        }

        /* Mermaid styling */
        .mermaid {
            @apply flex justify-center my-8 bg-white p-4 rounded-lg shadow-sm border border-slate-100;
        }

        /* Print styles */
        @media print {
            body {
                @apply bg-white;
            }

            #content {
                @apply shadow-none max-w-none p-0;
            }

            .no-print {
                display: none;
            }
        }
    </style>
</head>

<body class="bg-slate-100 min-h-screen py-10 px-4 sm:px-6 lg:px-8">

    <!-- Document Container -->
    <main id="content" class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-8 md:p-12 prose prose-slate">
        <!-- Loading State -->
        <div id="loading" class="animate-pulse space-y-4">
            <div class="h-8 bg-slate-200 rounded w-3/4"></div>
            <div class="h-4 bg-slate-200 rounded w-full"></div>
            <div class="h-4 bg-slate-200 rounded w-5/6"></div>
            <div class="h-40 bg-slate-200 rounded w-full mt-8"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="max-w-4xl mx-auto mt-8 text-center text-slate-400 text-sm no-print">
        <p>Generated dynamically from <code class="text-xs">proposal.md</code></p>
    </footer>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: 'Inter, Sarabun, sans-serif'
        });

        document.addEventListener('DOMContentLoaded', async () => {
            const contentDiv = document.getElementById('content');
            const loadingDiv = document.getElementById('loading');

            try {
                // Fetch the markdown file
                // Relative path since index.html is in the same folder as proposal.md
                const response = await fetch('./proposal.md');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const markdownText = await response.text();

                // Configure marked to handle mermaid code blocks
                const renderer = new marked.Renderer();
                const originalCodeRenderer = renderer.code.bind(renderer);

                renderer.code = (token) => {
                    // Check if token object (new marked version) or arguments
                    const code = token.text || token;
                    const lang = token.lang || (arguments[1] ? arguments[1] : '');

                    if (lang === 'mermaid') {
                        return `<div class="mermaid">${code}</div>`;
                    }
                    return originalCodeRenderer(token);
                };

                marked.use({ renderer });

                // Render content
                contentDiv.innerHTML = marked.parse(markdownText);

                // Render diagrams
                await mermaid.run({
                    querySelector: '.mermaid'
                });

            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800">Error Loading Document</h3>
                                <div class="mt-2 text-sm text-red-700">
                                    <p>${error.message}</p>
                                    <p class="mt-2 text-xs">Note: To view this file locally, you must use a local web server (due to CORS policies).</p>
                                    <code class="block mt-2 bg-red-100 p-1 rounded">python3 -m http.server</code>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                console.error('Error fetching markdown:', error);
            }
        });
    </script>
</body>

</html>